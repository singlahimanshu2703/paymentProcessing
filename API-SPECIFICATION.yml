openapi: 3.0.3
info:
  title: Payment Processing API
  description: |
    RESTful API for processing payments through Authorize.Net integration.
    Supports purchase, authorize, capture, cancel, and refund operations.
  version: 1.0.0
  contact:
    name: Payment Processing Team

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.example.com
    description: Production server

security:
  - bearerAuth: []

paths:
  /api/payments/purchase:
    post:
      summary: Process a purchase payment
      description: |
        Authorizes and captures a payment in a single transaction.
        Creates an order and processes payment immediately.
      operationId: purchasePayment
      tags:
        - Payments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
            example:
              amount: 100.50
              cardNumber: "4111111111111111"
              expirationDate: "2025-12"
              cvv: "123"
              customerEmail: "customer@example.com"
              description: "Order #12345"
      responses:
        '201':
          description: Payment processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
              example:
                success: true
                orderId: "ORD-ABC12345"
                transactionId: "1234567890"
                status: "CAPTURED"
                amount: 100.50
                authCode: "AUTH123"
                message: "Transaction successful"
                timestamp: "2025-01-21T10:30:00"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          description: Payment failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '502':
          description: Payment gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/payments/authorize:
    post:
      summary: Authorize a payment
      description: |
        Authorizes a payment without capturing funds.
        Order status will be set to AUTHORIZED.
        Use capture endpoint to complete the transaction.
      operationId: authorizePayment
      tags:
        - Payments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
            example:
              amount: 100.50
              cardNumber: "4111111111111111"
              expirationDate: "2025-12"
              cvv: "123"
              customerEmail: "customer@example.com"
              description: "Order #12345"
      responses:
        '201':
          description: Payment authorized successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentFailed'
        '502':
          $ref: '#/components/responses/GatewayError'

  /api/payments/capture/{orderId}:
    post:
      summary: Capture an authorized payment
      description: |
        Captures funds from a previously authorized payment.
        Order must be in AUTHORIZED status.
        Optional amount parameter for partial capture.
      operationId: capturePayment
      tags:
        - Payments
      parameters:
        - name: orderId
          in: path
          required: true
          description: The order ID from the authorization
          schema:
            type: string
            example: "ORD-ABC12345"
        - name: amount
          in: query
          required: false
          description: Optional amount for partial capture. If not provided, full amount is captured.
          schema:
            type: number
            format: decimal
            example: 100.50
      responses:
        '200':
          description: Payment captured successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Order not found or authorization transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          $ref: '#/components/responses/PaymentFailed'
        '502':
          $ref: '#/components/responses/GatewayError'

  /api/payments/cancel/{orderId}:
    post:
      summary: Cancel an authorized or captured payment
      description: |
        Voids/cancels a payment transaction.
        Order must be in AUTHORIZED or CAPTURED status.
      operationId: cancelPayment
      tags:
        - Payments
      parameters:
        - name: orderId
          in: path
          required: true
          description: The order ID to cancel
          schema:
            type: string
            example: "ORD-ABC12345"
      responses:
        '200':
          description: Payment cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '400':
          description: Order cannot be cancelled (invalid status)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Order not found or no successful transaction found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          $ref: '#/components/responses/PaymentFailed'
        '502':
          $ref: '#/components/responses/GatewayError'

  /api/payments/refund/{orderId}:
    post:
      summary: Refund a captured payment
      description: |
        Processes a refund for a captured payment.
        Order must be in CAPTURED status.
        Optional amount parameter for partial refund.
        Optional cardLastFour for refund processing.
      operationId: refundPayment
      tags:
        - Payments
      parameters:
        - name: orderId
          in: path
          required: true
          description: The order ID to refund
          schema:
            type: string
            example: "ORD-ABC12345"
        - name: amount
          in: query
          required: false
          description: Optional amount for partial refund. If not provided, full amount is refunded.
          schema:
            type: number
            format: decimal
            example: 50.25
        - name: cardLastFour
          in: query
          required: false
          description: Last 4 digits of the card. If not provided, will use stored card info.
          schema:
            type: string
            pattern: '^\d{4}$'
            example: "1111"
      responses:
        '201':
          description: Refund processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '400':
          description: Order is not captured, cannot refund
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Order not found or capture transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          $ref: '#/components/responses/PaymentFailed'
        '502':
          $ref: '#/components/responses/GatewayError'

  /api/auth/login:
    post:
      summary: Authenticate user
      description: Returns JWT token for API authentication
      operationId: login
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /api/auth/login

  schemas:
    PaymentRequest:
      type: object
      required:
        - amount
        - cardNumber
        - expirationDate
        - cvv
      properties:
        amount:
          type: number
          format: decimal
          minimum: 0.01
          description: Payment amount
          example: 100.50
        cardNumber:
          type: string
          pattern: '^\d{13,19}$'
          description: Credit card number (13-19 digits)
          example: "4111111111111111"
        expirationDate:
          type: string
          pattern: '^\d{4}-\d{2}$'
          description: Card expiration date in YYYY-MM format
          example: "2025-12"
        cvv:
          type: string
          pattern: '^\d{3,4}$'
          description: Card security code (CVV)
          example: "123"
        customerEmail:
          type: string
          format: email
          description: Customer email address
          example: "customer@example.com"
        description:
          type: string
          description: Optional order description
          example: "Order #12345"

    PaymentResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the transaction was successful
          example: true
        orderId:
          type: string
          description: Unique order identifier
          example: "ORD-ABC12345"
        transactionId:
          type: string
          description: Payment gateway transaction ID
          example: "1234567890"
        status:
          type: string
          enum: [CREATED, AUTHORIZED, CAPTURED, CANCELLED, REFUNDED, PARTIALLY_REFUNDED]
          description: Current order status
          example: "CAPTURED"
        amount:
          type: number
          format: decimal
          description: Transaction amount
          example: 100.50
        authCode:
          type: string
          description: Authorization code from payment gateway
          example: "AUTH123"
        message:
          type: string
          description: Response message
          example: "Transaction successful"
        timestamp:
          type: string
          format: date-time
          description: Transaction timestamp
          example: "2025-01-21T10:30:00"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Order not found"
        status:
          type: integer
          description: HTTP status code
          example: 404
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
          example: "2025-01-21T10:30:00"

    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: Username
          example: "admin"
        password:
          type: string
          format: password
          description: Password
          example: "password"

  responses:
    BadRequest:
      description: Invalid request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    PaymentFailed:
      description: Payment failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    GatewayError:
      description: Payment gateway error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
